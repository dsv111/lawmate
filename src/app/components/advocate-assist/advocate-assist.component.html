<div class="assist-container container">
  <h1 class="page-title text-3xl font-bold text-gray-800 text-center my-4">
    <img src="assets/training.gif" width="60" height="60" /> Advocate Mentor
  </h1>
  <p class="page-subtitle text-center">Your AI Senior Mentor – guiding junior lawyers like a seasoned advocate.</p>

  <mat-card class="assist-card">
    <mat-card-title>Provide Case Details</mat-card-title>
    <mat-card-content>
      <!-- Text Input -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Case Details</mat-label>
        <textarea matInput [(ngModel)]="userCaseDetails" rows="5"
          placeholder="Paste case facts, FIR details, or client brief..."></textarea>
      </mat-form-field>

      <!-- File Upload + Button on one row -->
      <div class="action-container flex items-center justify-between w-full">
        <div class="file-upload">
          <label for="fileInput" class="upload-label flex items-center gap-2 cursor-pointer">
            <mat-icon>attach_file</mat-icon>
            Attach Case File (DOCX, TXT)
          </label>
          <input type="file" id="fileInput" hidden (change)="onFileChange($event)" />
        </div>

        <div class="action-row">
          <button mat-raised-button color="primary" matTooltip="New Chat" matTooltipPosition="above"
            style="font-size:16px" (click)="startNewChat()">
            +
          </button>

          <button mat-raised-button color="primary" (click)="askMentor()">
            Get Mentor Advice
          </button>
        </div>
      </div>

      <!-- Loading (analysis or translation) -->
      <div #loadingArea *ngIf="isLoading" class="loading-section text-center">
        <ngx-skeleton-loader count="2" appearance="line"></ngx-skeleton-loader>
        <p>{{ loadingMessage }} <img src="assets/critical-thinking.gif" width="40" height="40" /></p>
      </div>

      <!-- Initial / Translated Response -->
      <div #responseArea *ngIf="botResponse && !isLoading" class="response-section response-box">
        <div class="language-selector" style="display:flex; justify-content:flex-end; margin-bottom:8px;">
          <mat-form-field appearance="fill" style="width:220px;">
            <mat-label>Select Language</mat-label>
            <mat-select [(ngModel)]="selectedLanguage" (selectionChange)="onLanguageChange()">
              <mat-option value="en">English</mat-option>
              <mat-option value="hi">Hindi</mat-option>
              <mat-option value="te">Telugu</mat-option>
              <mat-option value="ta">Tamil</mat-option>
              <mat-option value="kn">Kannada</mat-option>
              <mat-option value="ml">Malayalam</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Displayed response (translated or original) -->
        <div [innerHTML]="botResponse"></div>

        <div class="text-center mt-4">
          <button mat-stroked-button color="primary" type="button" (click)="toggleExtraInfo()" *ngIf="!showExtraInfo">
            Do you want more info?
          </button>
        </div>
      </div>

      <!-- Loading for Additional Details -->
      <div *ngIf="isExtraInfoLoading" class="extra-loading-section text-center">
        <p>Loading extra insights... <img src="assets/critical-thinking.gif" width="40" height="40" /></p>
      </div>

      <!-- Additional Details (Separate Section) -->
      <div #extroInfoArea *ngIf="showExtraInfo && !isLoading"
        class="extra-info-section mt-4 p-4 border border-gray-300 rounded bg-gray-50">
        <h4 class="text-lg font-semibold text-gray-800">Additional Details</h4>
        <div [innerHTML]="extraInfo"></div>
      </div>

      <!-- Follow-up Chat Section -->
      <div *ngIf="originalResponse && !isLoading && showExtraInfo" class="follow-up-chat mt-6 p-4 border-t">
        <h5 class="text-lg font-semibold mb-2">❓ Have more questions?</h5>
        <div *ngFor="let msg of followUpChats" class="my-3">
          <!-- User Message -->
          <div class="chat-row user">
            <div class="chat-bubble user-bubble">
              <mat-icon class="chat-icon user-icon">person</mat-icon><span style="text-shadow: 1px 1px #dee2e6;
    color: #0e66bf;font-size: 15px;">You :</span>
              <p>{{ msg.user }}</p>
            </div>
          </div>

          <!-- Mentor Message -->
          <div class="chat-row mentor">
            <div class="chat-bubble mentor-bubble">
              <mat-icon class="chat-icon mentor-icon">gavel</mat-icon>

              <span class="font-semibold text-sm" style="height: 20px;text-shadow: 1px 1px #dee2e6;
    color: #0e66bf;font-size: 15px;">Mentor :</span>
              <div [innerHTML]="msg.mentor"></div>
            </div>
          </div>
        </div>
        <mat-form-field appearance="outline" class="full-width mt-3 white-input">
          <mat-label>Ask a follow-up question...</mat-label>
          <input matInput [(ngModel)]="followUpQuery" (keyup.enter)="askFollowUp()" />
        </mat-form-field>
        <!-- <img src="assets/critical-thinking.gif" width="40" height="40" /> -->
        <button mat-raised-button color="accent" (click)="askFollowUp()" [disabled]="isFollowUpLoading">
          <ng-container *ngIf="isFollowUpLoading; else normalButton">
            <img src="assets/loading.gif" width="60" height="40" alt="Thinking..." />
          </ng-container>
          <ng-template #normalButton>
            Ask Mentor
          </ng-template> </button>
      </div>

    </mat-card-content>
  </mat-card>
</div>